/*=============================================================================
	Author:			Eric M. Barnard - @ericmbarnard								
	License:		MIT (http://opensource.org/licenses/mit-license.php)		
																				
	Description:	Validation Library for KnockoutJS							
===============================================================================
*/
!function(a){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?a(require("knockout"),exports):"function"==typeof define&&define.amd?define(["knockout","exports"],a):a(ko,ko.validation={})}(function(a,b){if(void 0===typeof a)throw"Knockout is required, please ensure it is loaded before loading this validation plug-in";a.validation=b;var c=a.validation,d=a.utils,e=d.unwrapObservable,f=d.arrayForEach,g=d.extend,h={registerExtenders:!0,messagesOnModified:!0,errorsAsTitle:!0,errorsAsTitleOnModified:!1,messageTemplate:null,insertMessages:!0,parseInputAttributes:!1,writeInputAttributes:!1,decorateElement:!1,decorateElementOnModified:!0,errorClass:null,errorElementClass:"validationElement",errorMessageClass:"validationMessage",grouping:{deep:!1,observable:!0},validate:{}},i=g({},h);i.html5Attributes=["required","pattern","min","max","step"],i.html5InputTypes=["email","number","date"],i.reset=function(){g(i,h)},c.configuration=i,c.utils=function(){var a=(new Date).getTime(),b={},d="__ko_validation__";return{isArray:function(a){return a.isArray||"[object Array]"===Object.prototype.toString.call(a)},isObject:function(a){return null!==a&&"object"==typeof a},values:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},getValue:function(a){return"function"==typeof a?a():a},hasAttribute:function(a,b){return null!==a.getAttribute(b)},getAttribute:function(a,b){return a.getAttribute(b)},setAttribute:function(a,b,c){return a.setAttribute(b,c)},isValidatable:function(a){return a&&a.rules&&a.isValid&&a.isModified},insertAfter:function(a,b){a.parentNode.insertBefore(b,a.nextSibling)},newId:function(){return a+=1},getConfigOptions:function(a){var b=c.utils.contextFor(a);return b||c.configuration},setDomData:function(a,e){var f=a[d];f||(a[d]=f=c.utils.newId()),b[f]=e},getDomData:function(a){var c=a[d];return c?b[c]:void 0},contextFor:function(a){switch(a.nodeType){case 1:case 8:var b=c.utils.getDomData(a);if(b)return b;if(a.parentNode)return c.utils.contextFor(a.parentNode)}return void 0},isEmptyVal:function(a){return void 0===a?!0:null===a?!0:""===a?!0:void 0},getOriginalElementTitle:function(a){var b=c.utils.getAttribute(a,"data-orig-title"),d=a.title,e=c.utils.hasAttribute(a,"data-orig-title");return e?b:d},async:function(a){window.setImmediate?window.setImmediate(a):window.setTimeout(a,0)}}}();var j=function(){var b=0,h=c.configuration,i=c.utils;return{init:function(a,d){b>0&&!d||(a=a||{},a.errorElementClass=a.errorElementClass||a.errorClass||h.errorElementClass,a.errorMessageClass=a.errorMessageClass||a.errorClass||h.errorMessageClass,g(h,a),h.registerExtenders&&c.registerExtenders(),b=1)},configure:function(a){c.init(a)},reset:c.configuration.reset,group:function(b,c){c=g(g({},h.grouping),c);var j=a.observableArray([]),k=null,l=[],m=function(){c.deep&&f(l,function(a){delete a.__kv_traversed})},n=function o(b,d){var g=[],h=e(b);b.__kv_traversed!==!0&&(c.deep&&(b.__kv_traversed=!0,l.push(b)),d=void 0!==d?d:c.deep?1:-1,a.isObservable(b)&&(b.isValid||b.extend({validatable:!0}),j.push(b)),h&&(i.isArray(h)?g=h:i.isObject(h)&&(g=i.values(h))),0!==d&&f(g,function(a){a&&!a.nodeType&&o(a,d+1)}))};return c.observable?(n(b),m(),k=a.computed(function(){var a=[];return f(j(),function(b){b.isValid()||a.push(b.error)}),a})):k=function(){var a=[];return j([]),n(b),m(),f(j(),function(b){b.isValid()||a.push(b.error)}),a},k.showAllMessages=function(a){void 0===a&&(a=!0),k(),f(j(),function(b){b.isModified(a)})},b.errors=k,b.isValid=function(){return 0===b.errors().length},b.isAnyMessageShown=function(){var a=!1;return k(),a=!!d.arrayFirst(j(),function(a){return!a.isValid()&&a.isModified()})},k},formatMessage:function(a,b){return"function"==typeof a?a(b):a.replace(/\{0\}/gi,e(b))},addRule:function(a,b){return a.extend({validatable:!0}),a.rules.push(b),a},addAnonymousRule:function(a,b){void 0===b.message&&(b.message="Error"),c.addRule(a,b)},addExtender:function(b){a.extenders[b]=function(a,d){return d.message||d.onlyIf?c.addRule(a,{rule:b,message:d.message,params:i.isEmptyVal(d.params)?!0:d.params,condition:d.onlyIf}):c.addRule(a,{rule:b,params:d})}},registerExtenders:function(){if(h.registerExtenders)for(var b in c.rules)c.rules.hasOwnProperty(b)&&(a.extenders[b]||c.addExtender(b))},insertValidationMessage:function(a){var b=document.createElement("SPAN");return b.className=i.getConfigOptions(a).errorMessageClass,i.insertAfter(a,b),b},parseInputValidationAttributes:function(a,b){f(c.configuration.html5Attributes,function(d){i.hasAttribute(a,d)&&c.addRule(b(),{rule:d,params:a.getAttribute(d)||!0})});var d=a.getAttribute("type");f(c.configuration.html5InputTypes,function(a){a===d&&c.addRule(b(),{rule:"date"===a?"dateISO":a,params:!0})})},writeInputValidationAttributes:function(a,b){var e=b();if(e&&e.rules){var g=e.rules();f(c.configuration.html5Attributes,function(b){var c,e=d.arrayFirst(g,function(a){return a.rule.toLowerCase()===b.toLowerCase()});e&&(c=e.params,"pattern"===e.rule&&e.params instanceof RegExp&&(c=e.params.source),a.setAttribute(b,c))}),g=null}},makeBindingHandlerValidatable:function(b){var c=a.bindingHandlers[b].init;a.bindingHandlers[b].init=function(b,d,e,f,g){return c(b,d,e,f,g),a.bindingHandlers.validationCore.init(b,d,e,f,g)}}}}();g(a.validation,j),c.rules={},c.rules.required={validator:function(a,b){var c,d=/^\s+|\s+$/g;return void 0===a||null===a?!b:(c=a,"string"==typeof a&&(c=a.replace(d,"")),b?(c+"").length>0:!0)},message:"This field is required."},c.rules.min={validator:function(a,b){return c.utils.isEmptyVal(a)||a>=b},message:"Please enter a value greater than or equal to {0}."},c.rules.max={validator:function(a,b){return c.utils.isEmptyVal(a)||b>=a},message:"Please enter a value less than or equal to {0}."},c.rules.minLength={validator:function(a,b){return c.utils.isEmptyVal(a)||a.length>=b},message:"Please enter at least {0} characters."},c.rules.maxLength={validator:function(a,b){return c.utils.isEmptyVal(a)||a.length<=b},message:"Please enter no more than {0} characters."},c.rules.pattern={validator:function(a,b){return c.utils.isEmptyVal(a)||null!==a.toString().match(b)},message:"Please check this value."},c.rules.step={validator:function(a,b){if(c.utils.isEmptyVal(a)||"any"===b)return!0;var d=100*a%(100*b);return Math.abs(d)<1e-5||Math.abs(1-d)<1e-5},message:"The value must increment by {0}"},c.rules.email={validator:function(a,b){return b?c.utils.isEmptyVal(a)||b&&/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(a):!0},message:"Please enter a proper email address"},c.rules.date={validator:function(a,b){return b?c.utils.isEmptyVal(a)||b&&!/Invalid|NaN/.test(new Date(a)):!0},message:"Please enter a proper date"},c.rules.dateISO={validator:function(a,b){return b?c.utils.isEmptyVal(a)||b&&/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/.test(a):!0},message:"Please enter a proper date"},c.rules.number={validator:function(a,b){return b?c.utils.isEmptyVal(a)||b&&/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(a):!0},message:"Please enter a number"},c.rules.digit={validator:function(a,b){return b?c.utils.isEmptyVal(a)||b&&/^\d+$/.test(a):!0},message:"Please enter a digit"},c.rules.phoneUS={validator:function(a,b){return b?c.utils.isEmptyVal(a)?!0:"string"!=typeof a?!1:(a=a.replace(/\s+/g,""),b&&a.length>9&&a.match(/^(1-?)?(\([2-9]\d{2}\)|[2-9]\d{2})-?[2-9]\d{2}-?\d{4}$/)):!0},message:"Please specify a valid phone number"},c.rules.equal={validator:function(a,b){var d=b;return a===c.utils.getValue(d)},message:"Values must equal"},c.rules.notEqual={validator:function(a,b){var d=b;return a!==c.utils.getValue(d)},message:"Please choose another value."},c.rules.unique={validator:function(a,b){var f=c.utils.getValue(b.collection),g=c.utils.getValue(b.externalValue),h=0;return a&&f?(d.arrayFilter(e(f),function(c){a===(b.valueAccessor?b.valueAccessor(c):c)&&h++}),(void 0!==g&&a!==g?1:2)>h):!0},message:"Please make sure the value is unique."},function(){c.registerExtenders()}(),a.bindingHandlers.validationCore=function(){return{init:function(b,d){var e=c.utils.getConfigOptions(b),f=d();if(e.parseInputAttributes&&c.utils.async(function(){c.parseInputValidationAttributes(b,d)}),e.insertMessages&&c.utils.isValidatable(f)){var g=c.insertValidationMessage(b);e.messageTemplate?a.renderTemplate(e.messageTemplate,{field:f},null,g,"replaceNode"):a.applyBindingsToNode(g,{validationMessage:f})}e.writeInputAttributes&&c.utils.isValidatable(f)&&c.writeInputValidationAttributes(b,d),e.decorateElement&&c.utils.isValidatable(f)&&a.applyBindingsToNode(b,{validationElement:f})},update:function(){}}}(),c.makeBindingHandlerValidatable("value"),c.makeBindingHandlerValidatable("checked"),a.bindingHandlers.validationMessage={update:function(b,d){var f=d(),g=c.utils.getConfigOptions(b),h=(e(f),!1),i=!1;f.extend({validatable:!0}),h=f.isModified(),i=f.isValid();var j=function(){return!g.messagesOnModified||h?i?null:f.error:null},k=function(){return!g.messagesOnModified||h?!i:!1};a.bindingHandlers.text.update(b,j),a.bindingHandlers.visible.update(b,k)}},a.bindingHandlers.validationElement={update:function(b,d){var f=d(),g=c.utils.getConfigOptions(b),h=(e(f),!1),i=!1;f.extend({validatable:!0}),h=f.isModified(),i=f.isValid();var j=function(){var a={},b=!g.decorateElementOnModified||h?!i:!1;return g.decorateElement||(b=!1),a[g.errorElementClass]=b,a};if(a.bindingHandlers.css.update(b,j),g.errorsAsTitle){c.utils.getAttribute(b,"data-orig-title"),b.title,"true"===c.utils.getAttribute(b,"data-orig-title");var k=function(){return!g.errorsAsTitleOnModified||h?i?{title:c.utils.getOriginalElementTitle(b),"data-orig-title":null}:{title:f.error,"data-orig-title":c.utils.getOriginalElementTitle(b)}:void 0};a.bindingHandlers.attr.update(b,k)}}},a.bindingHandlers.validationOptions=function(){return{init:function(a,b){var d=e(b());if(d){var f=g({},c.configuration);g(f,d),c.utils.setDomData(a,f)}}}}(),function(){function b(a,b,d){return b.validator(a(),void 0===d.params?!0:d.params)?!0:(a.setError(c.formatMessage(d.message||b.message,d.params)),!1)}function d(a,b,d){a.isValidating(!0);var e=function(e){var f=!1,g="";return a.__valid__()?(e.message?(f=e.isValid,g=e.message):f=e,f||(a.error(c.formatMessage(g||d.message||b.message,d.params)),a.__valid__(f)),a.isValidating(!1),void 0):(a.isValidating(!1),void 0)};b.validator(a(),d.params||!0,e)}a.extenders.validation=function(a,b){return f(c.utils.isArray(b)?b:[b],function(b){c.addAnonymousRule(a,b)}),a};var e={setError:function(a){this.error(a),this.__valid__(!1)},clearError:function(){this.error(null),this.__valid__(!0)}},h=function(){this.target.isModified(!0)};a.extenders.validatable=function(b,d){if(c.utils.isObject(d)||(d={enable:d}),"enable"in d||(d.enable=!0),d.enable&&!c.utils.isValidatable(b)){var f=c.configuration.validate||{},i={throttleEvaluation:d.throttle||f.throttle};b.error=a.observable(null),b.rules=a.observableArray(),b.isValidating=a.observable(!1),b.__valid__=a.observable(!0),b.isModified=a.observable(!1),b.isValid=a.computed(b.__valid__),g(b,e);var j=b.subscribe(h),k=a.computed(g({read:function(){return b(),b.rules(),c.validateObservable(b),!0}},i));g(k,i),b._disposeValidation=function(){this.isValid.dispose(),this.rules.removeAll(),this.isModified._subscriptions.change=[],this.isValidating._subscriptions.change=[],this.__valid__._subscriptions.change=[],j.dispose(),k.dispose(),delete this.rules,delete this.error,delete this.isValid,delete this.isValidating,delete this.__valid__,delete this.isModified}}else d.enable===!1&&b._disposeValidation&&b._disposeValidation();return b},c.validateObservable=function(a){for(var e,f,g=0,h=a.rules(),i=h.length;i>g;g++)if(f=h[g],!f.condition||f.condition())if(e=f.rule?c.rules[f.rule]:f,e.async||f.async)d(a,e,f);else if(!b(a,e,f))return!1;return a.clearError(),!0}}(),c.localize=function(a){var b;for(b in a)c.rules.hasOwnProperty(b)&&(c.rules[b].message=a[b])},a.applyBindingsWithValidation=function(b,d,e){var f,g,h=arguments.length;h>2?(f=d,g=e):2>h?f=document.body:arguments[1].nodeType?f=d:g=arguments[1],c.init(),g&&c.utils.setDomData(f,g),a.applyBindings(b,d)},a.validatedObservable=function(b){if(!c.utils.isObject(b))return a.observable(b).extend({validatable:!0});var d=a.observable(b);return d.isValid=a.observable(),d.errors=c.group(b),d.errors.subscribe(function(a){d.isValid(0===a.length)}),d}});